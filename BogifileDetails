i# Bogiefile for TypeScript CDK Project - Dev Environment

version: "1.0"

environment:
  name: dev
  runtime: nodejs:22
  variables:
    NODE_ENV: development
    CI_SERVER: "dev-ci-server.example.com"   # pipeline metadata value

phases:
  install:
    commands:
      - echo "üîß Installing dependencies..."
      - npm ci

  build:
    commands:
      - echo "üèóÔ∏è Building TypeScript project..."
      - npm run build

  synth:
    commands:
      - echo "üìú Synthesizing CloudFormation templates..."
      - npx cdk synth

  deploy:
    commands:
      - echo "üöÄ Deploying CDK app to AWS (dev)..."
      - npx cdk deploy --require-approval never --all

artifacts:
  files:
    - "cdk.out/**"


# Bogiefile for TypeScript CDK Project - Dev Environment

version: "1.0"

environment:
  name: dev
  runtime: nodejs:22
  variables:
    NODE_ENV: development
    CI_SERVER: "dev-ci-server.example.com"   # pipeline metadata value

phases:
  install:
    commands:
      - echo "üîß Installing dependencies..."
      - npm ci

  build:
    commands:
      - echo "üèóÔ∏è Building TypeScript project..."
      - npm run build

  synth:
    commands:
      - echo "üìú Synthesizing CloudFormation templates..."
      - npx cdk synth MyDevStack

  deploy:
    commands:
      - echo "üöÄ Deploying MyDevStack to AWS (dev)..."
      - npx cdk deploy --require-approval never MyDevStack

artifacts:
  files:
    - "cdk.out/**"

//Arnab

# Bogiefile for TypeScript CDK Project - Dev Environment

version: "1.0"

vars:
  asv: "platform"                # Example Application Service Vertical
  ba: "cloud-infra"              # Example Business Area
  component: "sns-eventbridge"   # Component/Project name
  owner: "team-devops@example.com"  # Owner/team email or group

pipeline:
  managed: true
  flavor: infra                  # pipeline type (infra for IaC/CDK projects)
  ci_server: "dev-ci-server.example.com"

feature_toggles:
  always_deploy_to_qa: false
  gitversion_enabled: false

tasks:
  infra_as_code:
    install:
      commands:
        - echo "üîß Installing dependencies..."
        - npm ci
    build:
      commands:
        - echo "üèóÔ∏è Building TypeScript project..."
        - npm run build
    synth:
      commands:
        - echo "üìú Synthesizing CloudFormation templates..."
        - npx cdk synth SnsEventbridgeDevStack
    deploy:
      commands:
        - echo "üöÄ Deploying SnsEventbridgeDevStack to AWS (dev)..."
        - npx cdk deploy --require-approval never SnsEventbridgeDevStack

artifacts:
  files:
    - "cdk.out/**"


//Arnab dev,qa

# Bogiefile for TypeScript CDK Project - Dev & QA Environments

version: "1.0"

# -----------------------------
# Project Metadata
# -----------------------------
vars:
  asv: "platform"
  ba: "cloud-infra"
  component: "sns-eventbridge"
  owner: "team-devops@example.com"
  region: "us-east-1"
  appId: "sns-eventbridge-app"
  cost_center: "12345"

# -----------------------------
# Pipeline configuration
# -----------------------------
pipeline:
  managed: true
  flavor: infra
  ci_server: "dev-ci-server.example.com"

# -----------------------------
# Feature toggles
# -----------------------------
feature_toggles:
  always_deploy_to_qa: false
  gitversion_enabled: false

# -----------------------------
# Tasks
# -----------------------------
tasks:
  infra_as_code:
    tool: cdk
    nodeVersion: 22
    chdir: "."  # root of CDK project, adjust if needed
    install:
      commands:
        - echo "üîß Installing dependencies..."
        - npm ci
    build:
      commands:
        - echo "üèóÔ∏è Building TypeScript project..."
        - npm run build
    synth:
      commands:
        - echo "üìú Synthesizing CloudFormation templates..."
        - npx cdk synth ${stack.id}
    deploy:
      commands:
        - echo "üöÄ Deploying stack ${stack.id}..."
        - npx cdk deploy --require-approval never ${stack.id}

# Optional Lambda metadata (CDK handles packaging)
  lambda_steps:
    - name: "MyLambdaFunction"
      chdir: "lambda-handler"

# -----------------------------
# Environments
# -----------------------------
environments:
  dev:
    aws_account_name: "123456789012"
    stack:
      - id: "SnsEventbridgeDevStack"
        appId: "sns-eventbridge"
        owner: "team-devops@example.com"
  qa:
    aws_account_name: "234567890123"
    stack:
      - id: "SnsEventbridgeQaStack"
        appId: "sns-eventbridge"
        owner: "team-devops@example.com"

# -----------------------------
# Artifacts
# -----------------------------
artifacts:
  files:
    - "cdk.out/**"

#For bogie testing

1Ô∏è‚É£ Using bogie-cli or local pipeline runner (if available)

Many organizations provide a Bogie CLI that can run the pipeline locally, simulating the CI/CD environment. Steps:

Install the CLI (if your org provides it).

Run the pipeline for a specific environment:

# Example
bogie run --env dev --task infra_as_code


This will execute your install, build, synth, and deploy commands exactly as the CI/CD would.

It respects chdir, nodeVersion, tool, etc.

‚úÖ Pros: Closest to actual pipeline behavior.
‚ùå Cons: Requires the org‚Äôs CLI and config files.

2Ô∏è‚É£ Manual local testing

If you don‚Äôt have a local Bogie runner, you can still test the CDK commands directly:

Go to your project folder (respect chdir if used):

cd /path/to/your/cdk/project


Install dependencies:

npm ci


Build TypeScript:

npm run build


Synth the stack (replace with your stack ID):

npx cdk synth SnsEventbridgeDevStack


This will generate CloudFormation templates in cdk.out/.

If it succeeds, your stack is syntactically correct.

Deploy to dev account (optional ‚Äî be careful!):

npx cdk deploy --require-approval never SnsEventbridgeDevStack


This simulates what the Bogie pipeline would do.

‚úÖ Pros: Works anywhere, no org CLI needed.
‚ùå Cons: Doesn‚Äôt test pipeline-level features like vars, feature_toggles, or automatic environment selection.

3Ô∏è‚É£ Optional: dry-run / synth-only approach

To avoid actually deploying resources, you can just run:

npx cdk synth


This ensures all stacks compile correctly and outputs the templates.

Useful for validating the Bogiefile commands locally before hitting real AWS accounts.

üí° Tip: You can even wrap the commands in a local shell script mimicking the Bogiefile tasks:

#!/bin/bash
set -e
cd .
npm ci
npm run build
npx cdk synth SnsEventbridgeDevStack
# npx cdk deploy --require-approval never SnsEventbridgeDevStack


Comment out deploy for dry-run.

Works as a local test harness for your Bogiefile.


//Latest multiRegion

version: "1.0"

vars:
  app: "my-stack"        # common application name
  region: "east"          # default region if not overridden

pipeline:
  managed: true
  flavor: infra
  ci_server: "dev-ci-server.example.com"

feature_toggles:
  always_deploy_to_qa: false
  gitversion_enabled: false

tasks:
  infra_as_code:
    tool: cdk
    nodeVersion: 22
    chdir: "."
    install:
      commands:
        - npm ci
        - cd lambda-handler && npm ci && cd ..
    build:
      commands:
        - npm run build
        - cd lambda-handler && npm run build && cd ..
    synth:
      commands:
        - npx cdk synth ${stack.id}
    deploy:
      commands:
        - npx cdk deploy --require-approval never ${stack.id}

environments:

  dev:
    vars:
      env: "dev"
      region: "east"
    aws_account_name: "123456789012"
    stack:
      - id: "${app}-${env}-${region}"

  qa:
    vars:
      env: "qa"
      region: "east"
    aws_account_name: "234567890123"
    stack:
      - id: "${app}-${env}-${region}"

  prod:
    vars:
      env: "prod"
      region: "west"
    aws_account_name: "345678901234"
    stack:
      - id: "${app}-${env}-${region}"



multiregions
version: "1.0"

vars:
  app: "my-stack"        # common application name

pipeline:
  managed: true
  flavor: infra
  ci_server: "dev-ci-server.example.com"

feature_toggles:
  always_deploy_to_qa: false
  gitversion_enabled: false

tasks:
  infra_as_code:
    tool: cdk
    nodeVersion: 22
    chdir: "."
    install:
      commands:
        - npm ci
        - cd lambda-handler && npm ci && cd ..
    build:
      commands:
        - npm run build
        - cd lambda-handler && npm run build && cd ..
    synth:
      commands:
        - npx cdk synth ${stack.id}
    deploy:
      commands:
        - npx cdk deploy --require-approval never ${stack.id}

environments:

  dev-east:
    vars:
      env: "dev"
      region: "east"
    aws_account_name: "123456789012"
    stack:
      - id: "${app}-${env}-${region}"

  dev-west:
    vars:
      env: "dev"
      region: "west"
    aws_account_name: "123456789012"
    stack:
      - id: "${app}-${env}-${region}"

  qa-east:
    vars:
      env: "qa"
      region: "east"
    aws_account_name: "234567890123"
    stack:
      - id: "${app}-${env}-${region}"

  prod-west:
    vars:
      env: "prod"
      region: "west"
    aws_account_name: "345678901234"
    stack:
      - id: "${app}-${env}-${region}"


bogie deploy --env dev-east
bogie deploy --env dev-west

#!/usr/bin/env node
import * as cdk from "aws-cdk-lib";
import { SnsEventbridgeSqsStack } from "../lib/sns-eventbridge-sqs-stack";

const app = new cdk.App();

// Pull values from context (set via --context in CDK CLI or from Bogie/CI)
const appName = app.node.tryGetContext("app") || "my-stack";
const envName = app.node.tryGetContext("env") || "dev";
const regionName = app.node.tryGetContext("region") || "east";

// Construct the stack ID dynamically
const stackId = `${appName}-${envName}-${regionName}`;

// Define AWS account (optional: can also come from context)
const account = process.env.CDK_DEFAULT_ACCOUNT || "<aws-account-id>";

// Instantiate the stack
new SnsEventbridgeSqsStack(app, stackId, {
  env: {
    account: account,
    region: `us-${regionName}-1`, // adjust if your region naming differs
  },
});


const appName = app.node.tryGetContext("app") || "my-stack";
const envName = app.node.tryGetContext("env") || "dev";
const regionName = app.node.tryGetContext("region") || "east";
const accountId = app.node.tryGetContext("account") || process.env.CDK_DEFAULT_ACCOUNT;

const stackId = `${appName}-${envName}-${regionName}`;

new SnsEventbridgeSqsStack(app, stackId, {
  env: {
    account: accountId,
    region: `us-${regionName}-1`,
  },
});


npx cdk deploy \
  --context app=my-stack \
  --context env=dev \
  --context region=east \
  --context account=123456789012


